cmake_minimum_required(VERSION 3.15)

find_package(SDL2 REQUIRED CONFIG)
find_package(box2d REQUIRED CONFIG)
# FIXME: sdl_image conan package still not adding properties
find_package(sdl_image REQUIRED CONFIG)
find_package(SDL2_mixer REQUIRED CONFIG)
find_package(CLI11 REQUIRED CONFIG)
find_package(fmt REQUIRED CONFIG)
find_package(tinkerforge-bindings REQUIRED CONFIG)

add_executable(flappy-frog main.cpp
                           Frog.cpp
                           Pipe.cpp
                           Game.cpp
                           World.cpp
                           Frog.hpp
                           Pipe.hpp
                           Game.hpp
                           World.hpp)
target_include_directories(flappy-frog PRIVATE include)

# FIXME: sdl_image conan package still not adding properties
target_link_libraries(flappy-frog CLI11::CLI11 fmt::fmt box2d::box2d SDL2::SDL2main 
                      sdl_image::sdl_image SDL2_mixer::SDL2_mixer tinkerforge::bindings)

install(TARGETS flappy-frog
        PUBLIC_HEADER DESTINATION include
        RUNTIME DESTINATION bin
        LIBRARY DESTINATION lib
        ARCHIVE DESTINATION lib)

file(GLOB ASSETS "${CMAKE_CURRENT_SOURCE_DIR}/../assets/*.*")
     
foreach(asset ${ASSETS})
        add_custom_command(TARGET flappy-frog POST_BUILD
                COMMAND ${CMAKE_COMMAND} -E copy_if_different
                ${asset}
                $<TARGET_FILE_DIR:flappy-frog>

                COMMAND ${CMAKE_COMMAND} -E copy_if_different
                ${asset}
                ${CMAKE_INSTALL_PREFIX}/bin)
endforeach(asset)
